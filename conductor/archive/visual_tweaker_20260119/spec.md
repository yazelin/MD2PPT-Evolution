# 規格書: Visual Tweaker (視覺化即時調整) - `visual_tweaker_20260119`

## 1. 概述 (Overview)
本功能旨在提供預覽區與編輯器之間的「雙向綁定」互動體驗。使用者可以直接點擊預覽區中的元素（圖表、圖片、文字），透過隨選彈窗 (Contextual Popover) 進行直覺式調整，系統會自動將修改結果回寫至左側的 Markdown 原始碼。

## 2. 功能需求 (Functional Requirements)

### 2.1 互動觸發機制
- **隨選彈窗 (Contextual Popover)**：點擊特定元素時，在該元素附近顯示對應的調整介面，不離開預覽情境。
- **元素識別**：預覽區渲染時需附加元數據 (Metadata)，以便 Tweaker 識別該內容對應於 Markdown 中的哪一行或哪一個區塊。

### 2.2 核心調整功能
- **圖表數據調整 (Charts)**：
    - 點擊圖表彈出表格輸入介面，可修改數值、標題與配置。
    - 採用「確認後更新 (Commit on Apply)」機制。
- **圖片屬性調整 (Images)**：
    - 提供工具列修改圖片網址、替代文字 (Alt)，以及視覺樣式（如圓角）。
    - 採用「確認後更新」機制。
- **文字快速編輯 (Text)**：
    - 支援標題或內文直接在預覽區進行內容覆寫。
    - 採用「即時同步 (Real-time Sync)」機制。

### 2.3 數據回寫邏輯 (Hybrid Mode)
- **智慧定位**：系統需精確計算目標區塊在 Markdown 中的位置，進行局部替換，避免破壞其他內容。
- **雙向同步**：Markdown 更新後，應確保預覽區與 Tweaker 狀態同步。

## 3. 非功能需求 (Non-Functional Requirements)
- **互動流暢度**：彈窗顯示與回寫反應應無明顯延遲。
- **視覺一致性**：Tweaker UI 須符合專案現有的「科技深夜」或「琥珀石墨」主題樣式。
- **魯棒性**：若 Markdown 語法格式異常，應提供降級處理，避免 Tweaker 導致應用程式崩潰。

## 4. 驗收標準 (Acceptance Criteria)
- [ ] 點擊圖表能正確顯示數據修改彈窗，確認後左側 Markdown 同步更新。
- [ ] 點擊圖片能彈出屬性工具列並成功修改內容。
- [ ] 點擊文字區塊能直接編輯，且輸入時左側編輯器內容即時變動。
- [ ] 彈窗位置能隨視窗或預覽區捲動自動調整位置。

## 5. 超出範圍 (Out of Scope)
- 佈局 (Layout) 的視覺化拖放排序。
- 複雜的 CSS 動畫逐幀調整。
