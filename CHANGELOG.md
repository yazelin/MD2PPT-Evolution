# 更新日誌 (Changelog)

本專案的所有重大變更都將記錄在此檔案中。

格式基於 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，
並遵循 [語義化版本 (Semantic Versioning)](https://semver.org/spec/v2.0.0.html)。

## [0.14.4] - 2026-01-22

### 新增 (Added)
- **全域命令面板 (Command Palette)**:
    - **鍵盤驅動工作流**: 實作 `Ctrl + K` (Windows/Linux) 或 `Cmd + K` (macOS) 喚起指令中心。
    - **分層指令系統**: 支援嵌套子選單，將指令分類為「導航」、「佈局」、「元件」、「系統」與「匯出」。
    - **動態投影片搜尋**: 自動偵測投影片內容並提供搜尋跳轉功能。
    - **視覺優化**: 面板採用琥珀/石墨主題風格，具備高對比度、毛玻璃背景與精緻的動畫回饋。
    - **全域實體快捷鍵**: 支援 `D+M` (深色模式)、`E+P` (匯出 PPTX) 等連續組合鍵操作。

## [0.14.3] - 2026-01-22

### 重大架構遷移 (Major Architecture Migration)
- **Remark/Unified 解析管線**:
    - **完全 AST 驅動**: 捨棄手動正則切割，改採 Remark 解析 MDAST 樹，徹底解決複雜巢狀語法的解析邊界問題。
    - **高精度定位**: 整合 `startIndex` 與 `endIndex` 於 SOM 中，支援 Visual Tweaker 的字元級精準回寫。
    - **異步解析架構**: 整合 Unified 異步管線，為大型文件處理與未來 AI 自動化提供更佳的效能基礎。

## [0.14.2] - 2026-01-22

### 新增 (Added)
- **PWA (Progressive Web App) 離線化與原生化**:
    - **離線工作流**: 整合 `vite-plugin-pwa` 與 Workbox，支援在無網路環境下進行編輯與全螢幕演示。
    - **桌面端安裝**: 支援將應用程式安裝至 Windows/macOS/Linux 桌面，具備獨立視窗與圖示。
    - **智慧快取**: 自動快取 Shiki 語法高亮資源、Mermaid 引擎、Google Fonts 以及所有核心靜態資源。
    - **UI 狀態感知**: 在 Header 新增離線狀態燈與 PWA 安裝按鈕。
    - **無縫更新**: 實作「發現新版本」通知彈窗，確保使用者能手動觸發更新以獲得最新功能。

## [0.14.1] - 2026-01-22

### 新增 (Added)
- **投影片拖拽重排 (Drag & Drop Reordering)**:
    - **直覺式排序**: 在編輯器預覽區 (Preview Pane) 新增拖拽把手，支援透過拖移投影片縮圖來改變簡報順序。
    - **Markdown 自動同步**: 整合核心算法，重排後自動更新 Markdown 原始碼，並確保全域 YAML 配置（主題、標題等）始終固定在檔案頂端。
    - **互動反饋**: 實作了佔位符 (Placeholder) 與半透明隨游標縮圖，提升操作體驗。
- **單元測試**: 新增 `tests/markdownReordering.test.ts` 驗證複雜 Markdown 結構下的重排正確性。

## [0.14.0] - 2026-01-21

### 新增 (Added)
- **圖片包匯出功能 (Export as Images ZIP)**:
    - **高品質擷取**: 實作 `ImageExportService`，利用 `html2canvas` 產生 2x 縮放的高解析度 PNG 圖片。
    - **批次打包**: 整合 `jszip` 將所有投影片圖片自動打包為 ZIP 壓縮檔，方便用於 LinkedIn 等社交平台分享。
    - **Header 整合**: 在頂部工具列新增「Images」按鈕，並具備即時載入狀態顯示。
- **單元測試**: 新增 `tests/imageExport.test.ts` 驗證圖片產生與壓縮流程。

### 修正 (Fixed)
- **核心 Hook 穩定性**: 修復了 `useMarkdownEditor` 在更新過程中因代碼丟失導致的 `ReferenceError` 執行期錯誤。

## [0.13.0] - 2026-01-21

### 核心重構與架構優化 (Architecture & Refactoring)
- **引入 SOM (Slide Object Model)**: 實作了中間層數據模型，將 Markdown 解析與多端渲染（PPTX/HTML）解耦，提升了系統的可擴展性與維護性。
- **Controller 模式實作**: 建立了 `useEditorController` Hook，將編輯器的複雜業務邏輯從 UI 組件中抽離，實現了清晰的職責分離。
- **佈局引擎抽象化**: 建立全域 `LayoutEngine`，統一管理投影片邊距、分欄比例與座標計算，確保預覽與匯出效果 100% 一致。
- **Registry 模式統一**: 預覽渲染器現在與 PPT 生成器一致，採用註冊表模式管理，消除冗長的 Switch-Case 代碼。

### 效能與代碼優化 (Optimization)
- **解析效能提升**: 重構 `markdownParser`，將分頁解析從 $O(N^2)$ 優化至 $O(N)$，顯著提升處理大型文件的速度。
- **語法高亮單例化**: 統一 `shiki` 高亮引擎的管理與預載入機制，減少了預覽時的閃爍並節省記憶體開銷。

### 測試與穩定性 (Stability)
- **全域 Mock 系統**: 建立 `tests/setup.ts` 統一管理環境模擬，解決 JSDOM 環境下的相容性問題。
- **100% 測試覆蓋率**: 達成全案 116 個測試案例全部通過，並新增了邊界案例與整合測試。

### 文檔完善 (Documentation)
- **API 參考手冊**: 新增 `docs/API_REFERENCE.md`，詳列所有支援的 YAML 配置與自定義語法。
- **開發者貢獻指南**: 新增 `CONTRIBUTING.md`，提供架構導覽與新增功能的逐步教學。

### 依賴更新 (Dependencies)
- **核心套件升級**: 升級 Vite 7, TypeScript 5.9, Vitest 4 及 i18next 至最新版本，獲取更佳的編譯效能與開發體驗。
- **安全掃描**: 通過 `npm audit` 深度檢查，確保 0 漏洞。

## [0.12.5] - 2026-01-21

### 新增 (Added)
- **演講者主控台導覽側欄 (Slide Navigator)**:
    - **全投影片縮圖**: 在主控台左側新增導覽側欄，即時呈現所有投影片的視覺縮圖。
    - **快速跳轉功能**: 支援點擊縮圖立即跳轉至指定頁面，並同步更新觀眾視圖與手機遙控。
    - **智慧自動捲動**: 當前投影片變更時，側欄會自動捲動至對應縮圖位置，並以橘色邊框高亮顯示。
- **單元測試增強**: 針對 `PresenterConsole` 導覽列功能新增完整測試，並優化了測試環境中的 `localStorage` 模擬。

## [0.12.4] - 2026-01-21

### 新增 (Added)
- **預覽語法高亮 (Preview Syntax Highlighting)**:
    - **全平台同步高亮**: 在編輯器預覽區、觀眾視圖 (Audience View) 及演講者主控台導入 `shiki` 渲染引擎。
    - **動態主題切換**: 程式碼區塊會根據投影片背景亮度自動切換至 `github-dark` 或 `github-light` 主題，確保最佳可讀性。
    - **視覺樣式優化**: 針對 Web 預覽環境優化了代碼區塊的內距、字體大小及圓角設計，使其與 PPT 匯出效果高度一致。

## [0.12.3] - 2026-01-21

### 新增 (Added)
- **AI 輔助生成 (AI Assistant)**:
    - **整合提示視窗**: 在 Header 新增 AI Assistant 按鈕，點擊即可喚起專為本專案設計的 AI Prompt。
    - **一鍵轉換流**: 提供針對 ChatGPT 與 Gemini 優化的指令，協助使用者將原始筆記精準轉化為符合規範的 Markdown。
    - **快速導覽**: 視窗內建 ChatGPT 與 Gemini 的快捷連結，並支援一鍵複製 Prompt 到剪貼簿。

### 修正 (Fixed)
- **Visual Tweaker 邏輯優化**:
    - **背景調整修正**: 修正了 Background Tweaker 在修改背景色或重捲 (Re-roll) 時會重複產生 YAML 或累積空白行的問題。
    - **區塊偵測強化**: 提升了 `replaceContentByLine` 對 YAML 區塊與自定義容器 (:::) 的識別精度，確保原地替換而不破壞文件結構。
    - **內容同步優化**: 修正了 Tweaker 更新內容時可能導致 Markdown 區域不斷增長的空白行累積問題。

## [0.12.2] - 2026-01-21

### 修正 (Fixed)
- **佈局渲染修復**:
    - **分欄佈局 (Two-Column/Grid)**: 修正了解析引擎對 `:: right ::` 識別不穩定的問題，確保內容能正確分流至右側欄位。
    - **角色對話溢出**: 調整 `CHAT_CUSTOM` 對話框的字體、內距與垂直邊距，徹底解決中置對話模式超出投影片底部的問題。
    - **內容裁切修正**: 將 `SlideContent` 內層容器的 `overflow-hidden` 改為 `overflow-visible`，並精簡教學內容，確保清單項目不再被截斷。
- **表格排版優化**: 調降預覽中表格的字體大小 (`text-lg`) 並縮減 Cell 內邊距，提升在固定比例投影片中的容納能力。

### 優化 (Improved)
- **全域字體比例縮放**: 全面下調預覽區中標題（H1-H3）、清單及正文的字體大小與垂直間距，使其與 PPT 匯出後的視覺佔比更加接近，有效預防內容溢出。
- **預設教學內容更新**:
    - **邏輯重排**: 重新編排 `defaultContent.ts` 的投影片序號（1 至 11），修正序號混亂與重複的問題。
    - **精簡文字**: 二度優化「演講模式」與「手機遙控」的文案，確保在雙欄佈局下擁有極致的呼吸空間。

## [0.12.1] - 2026-01-21

### 修正 (Fixed)
- **演講模式排版修復**:
    - **全設備縮放支援**: 實作 `ScaledSlideContainer` 搭配 `ResizeObserver`，確保投影片在各種筆電螢幕下均能等比例縮放 (`contain`)，解決內容超出視窗的問題。
    - **同步競態修正**: 整合 `localStorage` 狀態快取，解決開啟投影視窗後偶爾需手動觸發 (Blackout) 才有畫面的延遲問題。
    - **循環引用修復**: 抽離 `SlideContent` 核心渲染器，修正預覽畫面變白的執行期錯誤。
- **圖表排版優化**: 調整 `ChartPreview` 高度與邊距，並優化 X 軸 Label 的顯示空間，確保圖表數據在投影片內完整呈現。
- **功能找回**: 修正 Header 樣式邏輯，恢復被誤隱藏的「匯出 Markdown (MD)」按鈕。

### 優化 (Improved)
- **視覺對比感知系統**: 
    - 實作自動亮度檢測，當切換至淺色背景時，若主題文字過淺會自動強制轉為深灰色，避免「白底白字」。
    - 統一 `SlideRenderer` 渲染邏輯，確保編輯器與演講模式的視覺效果（Padding、Logo、顏色）100% 一致。
- **主控台操作增強**:
    - **快速重開**: 在主控台新增「重新開啟投影 (Project)」按鈕，防止誤關視窗。
    - **快速結束**: 新增「結束演講 (Exit)」按鈕，方便演講者快速回到編輯器。
- **Header 空間優化**: 針對筆電小螢幕進行 RWD 調校，縮減工具列間距並實作回應式標籤隱藏。

## [0.12.0] - 2026-01-21

### 新增 (Added)
- **Web 演講模式與遙控 (Presenter Mode & Remote)**:
    - **雙螢幕演講者視圖**: 點擊「Present」按鈕開啟獨立的觀眾視窗，主視窗即刻切換為專業的演講者主控台。
    - **演講者儀表板**: 主控台整合了「當前投影片 (大圖)」、「下一頁預覽 (Next Slide)」、「演講備忘錄 (Speaker Notes)」以及「即時演講計時器 (Timer)」。
    - **P2P 手機遙控器**: 內建 WebRTC 點對點連線功能，完全無需後端伺服器。
    - **QR Code 快速配對**: 演講者只需用手機掃描主控台上的 QR Code，即可將手機變身為無線簡報筆。
    - **遙控功能**: 支援手機端「上一頁/下一頁」翻頁及「黑屏 (Blackout)」模式切換。
    - **全即時同步**: 利用 `BroadcastChannel` 與 P2P 技術，確保主控台、觀眾視窗與手機遙控器三端狀態毫秒級同步。

## [0.11.0] - 2026-01-20

### 新增 (Added)
- **企業級品牌系統 (Enterprise Brand System)**:
    - **獨立品牌設定視窗**: 集中管理公司 CI 規範，包含主色、輔助色、強調色。
    - **全域 Logo 管理**: 支援上傳企業 Logo (Base64)，並可選擇四個角落的顯示位置。
    - **共通安全字體**: 內建 7 種 PPT 共通字體選單，確保在任何電腦開啟簡報時視覺一致。
    - **配置匯入/匯出**: 支援 `brand.json` 拖放匯入與一鍵匯出，方便團隊共享規範。
    - **自動化標題/圖表變色**: 設定品牌色後，所有 Slide 標題、表格表頭及數據圖表將自動同步更新。
    - **PPTX 匯出增強**: 匯出的檔案現在會自動在每一頁投影片插入品牌 Logo 並套用指定字體。

### 優化 (Improved)
- **主題專業化重構**:
    - **潔淨背景原則**: 重新設計所有預設主題，移除強制的大面積 Mesh 背景，改回專業的純白/深色底色。
    - **視覺對比度優化**: 調整主題文字顏色，確保在純色背景下具備極高的可讀性。
    - **Mesh 背景選項化**: Mesh 效果不再是預設，而是在需要時由使用者手動開啟的視覺選項。

## [0.10.0] - 2026-01-19

### 新增 (Added)
- **動態背景生成器 (Generative Backgrounds)**:
    - **Mesh Gradient 引擎**: 引入輕量級生成藝術算法，自動產生平滑的多色漸層背景。
    - **YAML 驅動**: 支援 `bg: mesh` 及其自定義顏色與隨機種子參數。
    - **Visual Tweaker 整合**: 支援直接點擊背景進行即時顏色調整與「Re-roll」重新隨機生成。
    - **PPTX 匯出支援**: 匯出時自動將生成的 SVG 背景轉換為高解析度圖片嵌入投影片。
    - **斜線指令**: 新增 `/bg-mesh` 快速插入背景配置模板。

## [0.9.0] - 2026-01-19

### 新增 (Added)
- **視覺化即時調整 (Visual Tweaker)**:
    - **雙向綁定**: 點擊預覽區的標題、圖片或圖表，即可喚起浮動調整視窗。
    - **所見即所得**: 支援即時修改文字內容、圖片屬性 (URL/Alt) 與圖表數據 (JSON Config/Table)。
    - **智能回寫**: 修改結果會自動同步回寫至 Markdown 原始碼，不破壞原有格式。
- **斜線指令系統 (Slash Commands)**:
    - **快速喚起**: 在編輯器輸入 `/` 即可跳出懸浮選單，無需記憶複雜語法。
    - **豐富模板**: 支援一鍵插入「新投影片」、「圖表 (Bar/Line/Pie)」、「佈局 (Grid/Two-Column/Quote)」及「多媒體元件」。
    - **即時過濾**: 輸入 `/ch` 自動篩選出 Chart 相關指令，支援模糊搜尋。
    - **智慧導航**: 完整支援鍵盤操作 (`↑`/`↓`/`Enter`/`Esc`)，插入模板後游標自動定位至關鍵編輯點 (`$cursor`)。
    - **視覺優化**: 選單具備 **Auto-flip** 機制，當底部空間不足時自動向上彈出，避免畫面遮擋。

## [0.8.1] - 2026-01-16

### 優化 (Improved)
- **Header UI/UX 重構**:
    - 將原生下拉選單替換為精美的 **自定義主題與尺寸選擇器**，支援視覺化預覽與 Check 標記。
    - **RWD 響應式優化**: 針對中小型螢幕隱藏非核心文字標籤與副標，確保工具列不跑版。
    - **功能整合**: 將「配色工具」按鈕移至 Header，操作動線更直覺。
- **配色工具 (Color Picker) 升級**:
    - 面板移至右側顯示，徹底解決遮擋 Markdown 編輯器的問題。
    - **複製功能**: 色碼顯示方塊改為具備動畫回饋的「複製按鈕」，支援一鍵取得 HEX 色碼。
    - **對比度感知**: 內部圖示會根據背景色亮度自動切換深淺色，確保清晰可見。
- **側邊欄語系化**: 側欄群組標題、按鈕名稱及工具提示現在會隨語系切換 (zh/en) 自動同步。

### 修復 (Fixed)
- **功能找回**: 修復了因 RWD 優化誤設隱藏導致的 **「重置範例 (RESET)」** 按鈕消失的問題。
- **執行期錯誤**: 修正了 `EditorHeader.tsx` 中遺漏 `React` 匯入導致的 `Uncaught ReferenceError`。
- **引擎修復**: 修復了 `pptGenerator.ts` 中因拼寫錯誤 (`PPT_THEHE`) 與重複代碼導致的建置失敗。
- **選單遮擋**: 解決了主題選單彈出時被父容器 `overflow-hidden` 裁切的問題。

## [0.8.0] - 2026-01-16

### 新增 (Added)
- **全域主題管理器 (Theme Manager)**: 
    - 在側欄新增「主題與配色」面板（Icon: Palette）。
    - 內建 4 種專業主題：`Amber Graphite` (商務)、`Midnight Cyber` (科技)、`Academic Clean` (簡約)、`Material Teal` (現代)。
    - **色號配色盤**: 提供一鍵點擊插入色號至編輯器的功能。
    - **混合驅動架構**: 支援透過全域 YAML `theme: ...` 定義主題，並與 UI 選擇器自動同步。
- **動態樣式注入**: PPTX 匯出引擎現在會根據所選主題自動調整字體、背景色、強調色及圖表色盤。

## [0.7.0] - 2026-01-16
...
